<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Cliente - Plain Vanilla</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body, #root { height: 100%; font-family: 'Inter', sans-serif; }
        .material-icons-outlined { font-size: 20px; }
    </style>
    <script>
        tailwind.config = { theme: { extend: { colors: { pv: { pink: '#ff94a6', purple: '#8b37ed' } } } } }
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const Icon = ({ name, className = "" }) => <span className={`material-icons-outlined ${className}`}>{name}</span>;
        const Logo = ({ className = "w-10 h-10" }) => (
            <svg viewBox="0 0 211.98 211.98" className={className}>
                <defs><linearGradient id="pvGrad" x1="0" y1="105.99" x2="211.98" y2="105.99"><stop offset="0" stopColor="#ff94a6"/><stop offset="1" stopColor="#8b37ed"/></linearGradient></defs>
                <path fill="url(#pvGrad)" d="M56.43,105.99c21.77-10.17,39.38-27.79,49.56-49.56,10.18,21.77,27.79,39.38,49.56,49.56-21.77,10.18-39.39,27.79-49.56,49.56-10.18-21.77-27.79-39.39-49.56-49.56ZM211.98,92.84C163.57,86.86,125.12,48.41,119.14,0c48.4,5.97,86.86,44.43,92.83,92.83ZM92.84,0C86.87,48.41,48.41,86.87,0,92.84,5.97,44.43,44.43,5.97,92.84,0ZM0,119.15c48.4,5.98,86.86,44.43,92.83,92.83C44.43,206,5.98,167.55,0,119.15ZM119.14,211.98c5.97-48.41,44.43-86.87,92.84-92.84-5.97,48.41-44.43,86.87-92.84,92.84Z"/>
            </svg>
        );

        const Card = ({ children, className = "" }) => <div className={`bg-white rounded-xl shadow-sm border border-gray-100 ${className}`}>{children}</div>;

        function App() {
            const [project, setProject] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            const token = new URLSearchParams(window.location.search).get('token');

            useEffect(() => {
                if (!token) {
                    setError('Token de acceso no proporcionado');
                    setLoading(false);
                    return;
                }

                fetch(`/api/portal/project?token=${token}`)
                    .then(r => r.ok ? r.json() : Promise.reject('Token inválido o expirado'))
                    .then(setProject)
                    .catch(e => setError(typeof e === 'string' ? e : 'Error cargando proyecto'))
                    .finally(() => setLoading(false));
            }, []);

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
                        <Logo className="w-20 h-20 animate-pulse" />
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
                        <Card className="p-8 max-w-md w-full mx-4 text-center">
                            <Icon name="error" className="text-5xl text-red-500 mb-4" />
                            <h1 className="text-xl font-bold text-gray-800 mb-2">Acceso denegado</h1>
                            <p className="text-gray-500">{error}</p>
                        </Card>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="bg-white border-b">
                        <div className="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <Logo className="w-8 h-8" />
                                <div>
                                    <div className="font-semibold text-gray-800">Plain Vanilla</div>
                                    <div className="text-xs text-gray-500">Portal de Cliente</div>
                                </div>
                            </div>
                            <span className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">{project.status}</span>
                        </div>
                    </header>

                    {/* Content */}
                    <main className="max-w-5xl mx-auto px-4 py-8">
                        <div className="mb-8">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">{project.name}</h1>
                            <p className="text-gray-500">{project.client}</p>
                            {project.description && <p className="text-gray-600 mt-4">{project.description}</p>}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {/* Documentos */}
                            {project.permissions.includes('files') && (
                                <Card className="p-6">
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 rounded-lg bg-teal-100 flex items-center justify-center">
                                            <Icon name="folder" className="text-teal-600" />
                                        </div>
                                        <h2 className="font-semibold text-gray-800">Documentos</h2>
                                    </div>
                                    {project.hasFiles ? (
                                        <div className="text-center py-8 text-gray-400">
                                            <Icon name="cloud_download" className="text-4xl mb-2" />
                                            <p className="text-sm">Los documentos estarán disponibles aquí</p>
                                        </div>
                                    ) : (
                                        <div className="text-center py-8 text-gray-400">
                                            <Icon name="folder_off" className="text-4xl mb-2" />
                                            <p className="text-sm">Sin documentos todavía</p>
                                        </div>
                                    )}
                                </Card>
                            )}

                            {/* Tareas */}
                            {project.permissions.includes('tasks') && (
                                <Card className="p-6">
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center">
                                            <Icon name="task_alt" className="text-green-600" />
                                        </div>
                                        <h2 className="font-semibold text-gray-800">Tareas del proyecto</h2>
                                    </div>
                                    {project.hasTasks ? (
                                        <div className="text-center py-8 text-gray-400">
                                            <Icon name="checklist" className="text-4xl mb-2" />
                                            <p className="text-sm">Las tareas estarán disponibles aquí</p>
                                        </div>
                                    ) : (
                                        <div className="text-center py-8 text-gray-400">
                                            <Icon name="assignment_late" className="text-4xl mb-2" />
                                            <p className="text-sm">Sin tareas todavía</p>
                                        </div>
                                    )}
                                </Card>
                            )}
                        </div>

                        {/* Contacto */}
                        <Card className="p-6 mt-6">
                            <h2 className="font-semibold text-gray-800 mb-4">¿Necesitas ayuda?</h2>
                            <p className="text-gray-600 text-sm mb-4">Si tienes alguna pregunta sobre el proyecto, no dudes en contactarnos.</p>
                            <a href="mailto:hola@plainvanilla.ai" className="inline-flex items-center gap-2 text-pv-purple hover:underline">
                                <Icon name="email" />
                                hola@plainvanilla.ai
                            </a>
                        </Card>
                    </main>

                    {/* Footer */}
                    <footer className="border-t mt-12">
                        <div className="max-w-5xl mx-auto px-4 py-6 text-center text-sm text-gray-400">
                            © {new Date().getFullYear()} Plain Vanilla Solutions
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
